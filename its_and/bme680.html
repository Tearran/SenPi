<html>
<head>
  <title>Chartist.js Line Graph</title>
  <link rel="stylesheet" href="//cdn.jsdelivr.net/chartist.js/latest/chartist.min.css">
  <script src="//cdn.jsdelivr.net/chartist.js/latest/chartist.min.js"></script>
  <style>

   body {
	   background: #000;
	   stroke: #ffa500;
	   color:yellow;
   }

.row {
  display: flex;
  flex-wrap: wrap;
}

.col-md-6 {
  width: 50%;
}



.temperature-chart,
.pressure-chart,
.humidity-chart,
.gas-chart {
  background-color: black;
  color: yellow;
}

.ct-label.ct-horizontal,
.ct-label.ct-vertical {
  color: orange;
}

.ct-series-a .ct-line,
.ct-series-a .ct-point {
  stroke: #00e5ff;
}

.pressure-chart .ct-line,
.pressure-chart .ct-point {
  stroke: #ff6347;
}

.humidity-chart .ct-line,
.humidity-chart .ct-point {
  stroke: #FFD700;
}


</style>
</head>
<body>


<div class="row">
  <div class="col-md-6 temperature-chart">Temperature </div>
  <div class="col-md-6 pressure-chart">Pressure </div>
</div>

<div class="row">
	  <div class="col-md-6 humidity-chart">Humidity</div>
	  <div class="col-md-6 gas-chart">volGas</div>
</div>
<div id="ticker"></div>
<script>
// Set up the charts with initial data
var temperatureData = {
  labels: [],
  series: [[]]
};

var temperatureOptions = {
  height: 200,
  axisX: {
    labelInterpolationFnc: function(value, index) {
      return index % 5 === 0 ? value : null;
    }
  },
  lineSmooth: false,
  low: 20, // minimum temperature value
  high: 30 // maximum temperature value
};

var temperatureChart = new Chartist.Line('.temperature-chart', temperatureData, temperatureOptions);

var pressureData = {
  labels: [],
  series: [[]]
};

var pressureOptions = {
  height: 200,
  axisX: {
    labelInterpolationFnc: function(value, index) {
      return index % 5 === 0 ? value : null;
    }
  },
  lineSmooth: false,
  low: 700, // minimum pressure value
  high: 900 // maximum pressure value
};

var pressureChart = new Chartist.Line('.pressure-chart', pressureData, pressureOptions);

var humidityData = {
  labels: [],
  series: [[]]
};

var humidityOptions = {

  height: 200,
  axisX: {
    labelInterpolationFnc: function(value, index) {
      return index % 5 === 0 ? value : null;
    }
  },
  lineSmooth: false,
  low: 0, // minimum humidity value
  high: 100 // maximum humidity value
};

var humidityChart = new Chartist.Line('.humidity-chart', humidityData, humidityOptions);

var gasData = {
  labels: [],
  series: [[]]
};

var gasOptions = {

  height: 200,
  axisX: {
    labelInterpolationFnc: function(value, index) {
      return index % 5 === 0 ? value : null;
    }
  },
  lineSmooth: false,
  low: 1000, // minimum volatile gas value
  high: 30000 // maximum volatile gas value
};

var gasChart = new Chartist.Line('.gas-chart', gasData, gasOptions);


// Fetch new data every second and update the charts
setInterval(function() {
  fetch('./bme680.json')
    .then(response => response.json())
    .then(json => {
        //var timestamp = new Date(json.timestamp * 1000).toLocaleTimeString();
        var timestamp = new Date().toLocaleTimeString();
        var temperature = json.temperature.toFixed(2);
        var pressure = json.pressure.toFixed(2);
        var humidity = json.humidity.toFixed(2);
        var gas = json.gas_resistance.toFixed(2);

        // Add the new data to the temperature chart
        temperatureData.labels.push(timestamp);
        temperatureData.series[0].push(temperature);

        // Add the new data to the pressure chart
        pressureData.labels.push(timestamp);
        pressureData.series[0].push(pressure);

        // Add the new data to the humidity chart
        humidityData.labels.push(timestamp);
        humidityData.series[0].push(humidity);

        // Add the new data to the gas chart
        gasData.labels.push(timestamp);
        gasData.series[0].push(gas);

        // Remove older data from the charts
        if (temperatureData.labels.length > 10) {
            temperatureData.labels.shift();
            temperatureData.series[0].shift();
        }

        if (pressureData.labels.length > 10) {
            pressureData.labels.shift();
            pressureData.series[0].shift();
        }

        if (humidityData.labels.length > 10) {
            humidityData.labels.shift();
            humidityData.series[0].shift();
        }
        if (gasData.labels.length > 10) {
            gasData.labels.shift();
            gasData.series[0].shift();
        }

        // Update the charts with the new data
        temperatureChart.update(temperatureData);
        pressureChart.update(pressureData);
        humidityChart.update(humidityData);
        gasChart.update(gasData);
    });

}, 1000);



</script>
</body>
</html>
